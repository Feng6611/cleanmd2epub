## 一句话描述
本工具使用 Google Gemini 1.5 Flash 模型清洗 OCR 识别后的 Markdown 文件，通过智能分段和上下文感知的方式提高文档可读性，支持异步处理和自动重试机制，并可将处理后的文档转换为EPUB电子格式。

## 核心功能
本工具采用分段处理和智能清洗的方式，通过 Gemini API 优化 Markdown 文档的格式和内容。主要解决 OCR 转换后文档存在的格式混乱、断句不当、标点错误等问题。核心功能包括智能分段、上下文感知的文本清洗、异步处理、结果预览和EPUB格式转换。

## 技术实现
1. **智能分段系统**
   - 基于标题层级和内容长度进行自适应分段
   - 支持最大块大小(3000字符)和最小块大小(2000字符)的动态调整
   - 保持段落和章节的完整性，避免在句子中间断开
   - 使用目标比例(0.8)优化分块大小

2. **文本清洗引擎**
   - 调用 Gemini 1.5 Flash 模型进行文本优化
   - 支持异步处理和自动重试(最多5次，间隔70秒)
   - 智能保持上下文连贯性
   - 自动处理标点、格式、段落等问题

3. **文件处理流程**
   - 输入文件验证和备份
   - 智能分段和清洗
   - 结果合并和保存
   - 生成处理报告
   - 自动转换EPUB格式

4. **用户交互**
   - 支持命令行操作
   - 提供首个分段的预览功能
   - 详细的进度显示
   - 完整的日志记录
   - 灵活的EPUB转换选项

5. **输出管理**
   - 自动创建输出目录结构
   - 保存原始文件、分段结果和清洗结果
   - 生成处理报告
   - 支持自定义输出路径
   - 生成EPUB电子书

6. **EPUB转换器**
   - 基于Pandoc实现高质量转换
   - 支持自定义元数据(标题、作者、语言等)
   - 可配置目录生成
   - 支持自定义封面和样式
   - 提供独立命令行工具

## 使用场景
- 学术论文的 OCR 转换后处理
- 电子书籍的格式优化和制作
- 文档扫描后的文本整理
- 批量文档的格式规范化
- 将文档转换为电子书阅读器支持的格式

## 技术特点
- 异步处理提升效率
- 智能分段保持文档结构
- 上下文感知提升质量
- 自动重试保障稳定性
- 结果预览确保质量
- 灵活的格式转换支持