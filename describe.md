
## 一句话描述

本工具使用 Google Gemini 1.5 Flash 模型清洗 OCR 识别后的 Markdown 文件，通过智能分段和上下文感知的方式提高文档可读性，支持异步处理和自动重试机制，并可将处理后的文档转换为EPUB电子格式。

## 核心功能

本工具采用分段处理和智能清洗的方式，通过 Gemini API 优化 Markdown 文档的格式和内容。主要解决 OCR 转换后文档存在的格式混乱、断句不当、标点错误等问题。核心功能包括智能分段、上下文感知的文本清洗、异步处理、结果预览和EPUB格式转换。

## 技术实现

### 1. MD文档拆分，分为前置部分和正文

- 匹配常见的正文开始标记，将其之前的部分判断为前置部分。举例
  - 第[一二三四五六七八九十]章
  - 引言
  - 序论
  - 目录

### 2. 前置部分清洗 & 抽取isbn、书籍名

- 将前置部分输入给AI，要求他「作为一个epub文件编辑，从读者的角度考虑，需要删除和保存的部分，并做基本的校对。json输出」，获得前置部分清洗后的数据，先存下来
- 将前置部分再次输入给AI，获得isbn、书籍名
  - 写一个豆瓣爬虫，通过isbn值获取这本书的相关metadata，存下来

### 3. 后置部分分块&清洗

- 分块逻辑
  - 计数方法：英文计 1，中文计 2
  - 按段落分
  - 配置项，设置每个分块最大字符数
  - 小于最小计数的部分多项合并，保证不超过最大字符数；大的随机使用二分法拆分，满足字符要求即可
- 依次将分块输入给AI，要求「清洗scan pdf转化后md文件，校对文本、调整段落、删除ocr的错误数据」

### 4. 转化为epub文件

- 设计css
- epub文件
  - 封面
  - 书名页（书名、作者、出版社、ISBN）
  - 其他必要信息
  - 目录
  - 正文
- image
- 结合matedata、css、清洗后的「前置部分」「后置部分」输入给pandoc处理，输出epub